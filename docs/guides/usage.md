# Project Basics

## Mental Model

Hikkaku is a compile-time DSL for Scratch.

- Code outside `run()` executes in your JavaScript environment (build time).
- Code inside `run()` and block handlers defines Scratch runtime behavior.
- Do not use browser or Node APIs inside runtime handlers.

## Minimal Project Structure

```ts twoslash
// @twoslash-cache: {"v":1,"hash":"3bc30558e1240eb8b21cc0010ee8cb2632a58504db13ce053ec46a589d35a92f","data":"N4Igdg9gJgpgziAXAbVAFwJ4AcZJACwgDcYAnEAGhDRgA808AKAQwBsBLZuASgAIBjVlzi8ACqQgArGPzQAdMOwC2WCKTRiJ02ZRBw0zdUgCcVVjDABzNPiQB2KgdKWYDRCHFSZDM+zC5EAAYqfnxDZlkyEwBfCnRsAIJiKMc6NxBlVXVeAEkAWQBBAHEAUQBlXX1DNwAWAGYzC2tbRAA2R0MXdPzi8t0OfyQARhCw0giackRjWPicPEISclT6JjZOHgEIMH1eADM1GCXEXkYwsChzUhPGPgBeAD5eIgh2KHungAl2AGsf5h+AFcAEKsCD8H4KTJqDQHUhHFIgKDghDuHJgPZ+dg0XhgiBYAB0CgU6KwgLQJwABudLmRKUSwAB5clkim8Mr8cZoUK8Ko0JQWDQAIzBEN4sExijQ7G2vBszA07BEzCwOAuMCgcogcvwMAEgNI8LAGjgnPYWBNBghBN0BksqOQyBAWHCSl0NKupw+z1eUBAAF0KE74WgDTtdByuTy+TABcbeCLwT9xTBJdiZWAdQreEreCq1bBNWhtTY9fwDUaTWaLbyrT8bYGnXRmCpzLpKR20HAoSoYbxgPtDkteNF9hIlLwAOT4X7/IEAekTELgk+JGKHZEYt14j370W4Cg7lIDgb0TjcAA4GiBzFYbPYOs5XHg4Qjlje/AEAEyjcKRKYzHE1AJAsyTvjQqzuCwHBcHw/DbLsXR5BAgJwDAAAaNzet8fwAiCoqQoovbZEhKFoehujIvwqIgMhqF6qocDptsDIkmArInJA/gMsyaAceynIKjy8JZJMCYESmabSrK8oaPwzCZkKer0ZqXB5pmfiss8bCAnqfi8BApakOJSZwDaHT2kgjogCGYYIFQkZCfgvAiTCZAmWKEpYtJmayQICkJspaGqcqGnseS2msLpOaZoZurGUuPxmQGQYgM2ra4FQR5dj2on9rwpH0ehI5jhAE7TrOeGLgRK5roV5G3IeHYnlQVRGNMP43k097TI+XR4PVGH9J+SCdaEf6TMMF6zMB8zuIsiIQek0EbHBCEaJYhkQOhACaNy0Cc4jKOmJBlChpD8DAAA8YCAkoSmkA8FC8Bgh2kMd0qnedl03XdD0PNhlVAqCSa5X2m3FrtlEongyEkCIxZbGoUB+Aq8CsWApLklStCUs9lIYPSCi8fxjncs5MZxsKEleVKGZZoqyqqhYhZajqZYVoKvLVpaET1razCWSgTouuMbpULQ7IwHqeyAmAsj00xlhgAqBoy2oeb8JdFoajFWlEDp6MpSLrq6BgUsy3LCuykrKuhvCg7GRE2s0JqmkRQbUVG42NmuHZEaCeTtZo1THnJrTzG+WEjN5sz6pFiWur6oaXOmu9NZVNaxtpbQLZYG2WWdt2RF5QOEPbTtJV7OOU4zrhC6JbVYAKOXu2MEMwS8B3B5gEeLVntUwyBNet7NEg7TUJ0z7uK3O3DYMiBjWMExRIvgFzIkC3gWkawwZs8E7CaADu2KhAAwhA+h3TAAAqEA3PBV8CicF9PzAZ0GpdgP1/hoMl32cAT7k1fqGAUd9obUTwGUIBoR4BbDfhjLGbJKSP1ATAImTIWTYwElGCmBh+Rc0SpJby9M/K5nzCzXWiNSzJ0rNzdOvMs4WQdCbMWuhUHXwtvsK2PleTsGVqrB2cJNYu11u7DQntdLJR9rZUg4YHKB2jPg2MhCaaphITJaOOYmYFioYnDmKd4xp3NIw/mPt0r50yiAbKxdoTZAHIA0++AQHXzvlXGuFUf7VVMquZuOwYHOMvmgu+jBJwcIFEMScPc+7+lPG1NwQxEmNDvC0IYABWPq089ABJcWAiA89vy/nGP+JAdQ7AzUwHNJISxbQ7ygusWCWxD68CPrqMAAAxIQlgz4cAhBqG4mcfgAH4sI7ieC8N4385y/whGDbIrSLCdMFj09gfS/RUCojRAASnLEQCzMyWHhBYfYXTtECF6T8DUiDwrIMGRgkm2CyZKJDqopMxC6aaOzOQuOrNqFJ3LIYqsDDg5MMnkLayosWyVDrF6MZPo3i8EZBaDMbAGypVkfIkATy8EvPjEQiOvCyE6MoQndmtDU48xBWY1KFiC7WKLnMjQA59lLO6Rc3Wo5q5lVrkDQE3jly+IUCyrpKy1lbm9MAfcTVjyxNaueYYX4LzJLHogdJmT0jCuWey9ZH4F5LwmqvNJNQKkgXmmBWpkEQAH12FgLQ3g3peB0HKweqq7AZK6ikh8k8nzpFtY6nwuqAg1CKSvKYrQTVVK3ha5aDTNj+CPpof1twHXaHkP/bInhU3QpdUMC8pgPUqocN6/q7hM3eAKUgYNVrl4lMXoECNm9zUrHSNajQ+dmAYDICcG+U80BXT2GwNCDxs3tS/IEd1o8eoTycCW50QhO3vgGAEd141imTTaA20CNTm14FbbwP1qaU3ludaOoYVbJ0tCLTOrJB7j2BqQCumt670mbrNdu6gdSQCMAFDYaAfAy2yAJJyGAaMyi2uxDARgKtn61nelYZ6+IfJwBGeycDNAkVIe4N23t/bB0wGHSetwX5iPKp6kMTq16W3wlA2hqxS6H0htrV+Oor7qmLU/Xu8JMAX5BOvls1MZALCXRHURtJIwC09Svb23dvGBQVraIx9d4agKVMbe+paMnmntoXdhn1uHWBDpE6NVo4mL3j3VXgbTiJ6MKerQaqYQxlMby3exy137XCEHeLwHtemB0GfwwSZgUAoC5Mg1xnjb8AAiCpmBYd4KF/jexBPyysfE4zSqJOpOCMWrJQWQuyboyNWzq7Q2jRYyp01bHt6WrsRoHopQKiEdGheCeZnbOUbwPVvovgF5FpK7WtJrGo07vcHus+BQb5n0+CULZAB9AoEW0FGbXiPbqLR80dfcONyb025sFHk31p9q9yNDabR+tzfqcDqAwHwULBJoPcdg34SwECaIADkWx6ggHsMlXHlt1ECK1tblaLPuAe/JjL/X11flO+pjj6193zq7d5nDfnDNNcQHUL8Ra2vTuk+4Kzi6itJLs2u1e9aKuRrOxpqCP7PN8B810fTQ6CSkDlmcBStJrinEo7ppnaP8Pegme8E4wv/t1HPcDzHoObJy3kyTqHq9ymU7U65mNe8+CarZasy5UBGCDJQ9uXcwu4s4WmSDWZ6aNBa9Fbr17eAdk7BaW0gqRzMx7FObmQQOurlriQVSO5PEsFsmxcHAheK1FSVIVo75ujSU0IBXQ4xGc6zmTBSw50ptnViiN+M30iLkXbFRdnDF9ksWKJxeH6mbyCXR6+cS+ObME+cyMZSwZaKmy5wyu2BlVv8o2+1e47lnjpn8qSoKsAA+fd69z3uaJzVZUD3ahLjLbW1U5Y1W01ltuNTy/1WTqYMOVcueq+r1aBUtptwOpoD67Avqf2urde6ZAnovTerf+/F1H9/Rf6b3lFvCJasL9IY54NkYZ3A4Y4FEZ4JkZUYaAzI/cbkcY8ZeACZ7lg8ThQ9KZXlPJ1EPko569Y448m9/kW8gUTEqU087QM9IVxYQBJYyhpZuF5ZeFbZBF1YnYtYYAdY3YblIopEO9M82EqBzZGDLYWDFZ+E7Y1ZHYRFuDXY9YPZDZpF0U/Y5Ey8sDlFQ58U8DI4GYzkKFG8/kDEk829U9s5aUrEbFGV8pZ4h9yo65R9G4J9Z525O5u5pV+40tMc7AgdPV2t8cQBZ55drxFcphjVj8301dd5z9HFgECsQlwt4sCsP4v8/8f4ACbC4jz4Ej8kwDIF3BoEnE4EuNrl+IUECt0C+JHkK8w8VEI8a9dDCUY8G9fl9FyVW9gV28BZwVWEoUQgCsuFZYJCbYpD2DZDnZ5CxE+DJFvZVD7ZMVNDcVq9cCo9PkY5DC2jfsyD6EKDujzEu9LEe9KQco+8HEclcj7CeUvFnC1xsjAk34QkwkCtIl58ZU4l5VMdjBVt/D19NtsknFQtwEesAgz1FNV4IjnMojT9NNdgkiEsBMjRhMMcahAh802spMfUZM355cq0wjRoKcoSqto0YjGlXwlgOcLgrhRljdfR0jzcCIbDyTERNlOsMRvI9Q8RCREDyiPQ6Qg9qiQ9ajsCGjViNECCNifk9FtjAVdiU8+YqDBYaCs8CBOdPRZ8xcZE1DFjhStCcDw4mi69JTiDjCOjyD5Ss4Di846VrCzjHY3wriR8qpbi/FmTSBxU4VJU3ivDPiahmNSNL0Zc3T5cJ58TEBITZpVcYT6kNdgCK5GBr8jolATp35vpv9n9HpnpXob9kzPpUyH9foMyAYTgzc8JMi+9gj8iaJICEZtQYDSAUY7Z0YeTsFKRcZ8ZCYBTSZdTliw53k9CiUiCSUSCTCKUujzDmErI+i6CGCmDhjrZMw2D7YOC5CeDFCJFlDBDaCzYhieFJCBFlyJiuC1zxF+C5jgxtSNCeyq8+za91iDCpT49SDZTk9TFBDLDjjTigCy5L9K5OUPFHDnSaoXDfy3DnoPDe4F8PiXUagagJ0pc8csSZ5fz5dDt7Nx5YdoiYzz9Bp0Jk1eBSzgZGSKzXA6JyJ7cICyIGJL5I4yjsEuIYAuyajcEXJuC3IEpI9xT9D5JFIgpdY1IApTzZiYoDIjIw5kpJzhZfYFiryWLXJ1B3IdC1iJT/JeLeAVI8xQp1yzyRK4pFKap3zDibTe9vyCpSKqLip/zh9AKG5gK6pzKipGpIL3iUS0lOo2sNtAjcLULwSHNysiThtzsW0Edb1ZAj0nUl9ahjB0SpdMTZ1QqA0bMSNSdStVVBtTx4JYA8BTKAMNArKHDeVfFTKusyhHSbK+VhBXAm5TK3TnpcK6rfznp7igSIBnop81kyreUx8m4FA90EqdxeB41E1U0nK+qkdjI7h907VANgMaN3oaBQlRBxqoleqEcuMBrCdAtgtQtGBgAFBeBeACQjqSqCRtspsZt5sKB9rBrPsThJxCcABaZgXxKVPxTatnMAD03cPazMZ3RZEVbVL6p4H6g6g61wzuQIHuUG3kC4x4iARgLjHua6g6t0oG/sZG0G1w3C24Z6SGjG16g61616hQOgPKCUZgQEVgNtaagNH9ZgJAUANICwJibYPALsEAaIaIIAA==="}
import { Project } from 'hikkaku'
import { IMAGES } from 'hikkaku/assets'
import { forever, getMouseX, gotoXY, switchCostumeTo, whenFlagClicked } from 'hikkaku/blocks'

const project = new Project()
const player = project.createSprite('Player')
const costume = player.addCostume({
  ...IMAGES.CATCHER_A,
  name: 'player-a'
})

player.run(() => {
  whenFlagClicked(() => {
    gotoXY(0, 0)
    switchCostumeTo(costume)

    forever(() => {
      gotoXY(getMouseX(), 0)
    })
  })
})

export default project
```

## Stage Usage

The stage is created automatically.

```ts twoslash
// @twoslash-cache: {"v":1,"hash":"60161b4055aee2c91d32a71800d59d4c454f134ae07414e76256791aa8dbbf45","data":"N4Igdg9gJgpgziAXAbVAFwJ4AcZJACwgDcYAnEAGhDRgA808BjCMONAAjYEMBzGRdgBUupPmgA8aUgFcYAPkohupBogBsVADYwwPNPiQBWKmhFi83Pos0BLMLkQAGKo3wiujGuXUBfCumwHAmIyRRp6JhY2dixSCAArGE8BAAU4xM9FZVUARgAWLR09A0QAdhMzGFUQWISkhi07B2cQV3dPUMR8vwCcPEISchM6aoAKWpwVDABKdjS6zwA6S34hSokpWQUqbKQAJj3C3X0jCtEqi1MrRvskFrbSDy99vZ8AXRdoIOZWDhX2AC8MXS9WWV1wVAAtlUuEhQCMdHAbCw8GgED4fEA=="}
import { Project } from 'hikkaku'
declare const project: Project
// ---cut---
const stage = project.stage
```

You can add costumes and scripts to the stage just like sprites.
You can also use `project.addCostume()` and `project.addSound()` as shortcuts for stage assets.

## Safe and Unsafe Patterns

Safe: resolve values at compile time, then embed them in blocks.

```ts twoslash
// @twoslash-cache: {"v":1,"hash":"fac8b3d070b4ebcc76528fdf836950638951ffb62d5ad8ea4f1c664e51c11ea4","data":"N4Igdg9gJgpgziAXAbVAFwJ4AcZJACwgDcYAnEAGhDRgA808BjCMONAAjYENS0ANROwBMAFkohuvJADYqAGxhgA5mnwyqaHkpgNEEzbz7i5ASzC5EABiqN8PLoxrlE0gL4V02CwWJlxNeiYWNnYsOS4MMkEAFS0dAB4AIwgIBS4wAD5xSV0ARgBOeUUVNRcNON0QMIi/eTMLIRs7UgcnJEt3Txw8QhJyDTpKgAoAWx1CKABKdljSbTQklLTMgDpSAFcwIbswKAVSQSGDeZiKxdSYdIzpgF4M9iIIEynBR+fsg10hWRAFZVUkABmcpzHR4DZgYz1JCNEC2eyOPyIADsnWoXh6vn61EGeCGXFMXDg0wA7vhFAAxcJKADCpkYAGsYFAhtxGQB+Q63e5vF7sAASJgZDK4DPWACE5BBGQAdMAmEZYCC8dhkynUukmRnM8RQaUIPQAJU2cFV5LA7CUpBginYADNqewTKbGPSmVAVnK5QBJMBYdZoQQAAzZDKDnrAAHkA/7A+wAMqMFpoWycTQ0MZgDiJKWM9iwO1mExoEwsdiqLgcZ3sLhYHC7ZnliDl8nsRjrUjWrOcJMmLAcUMrfxcJQG5DIKr2EYfBwM9hDbkPJ5QdiR/ulsAEocAXQoE+taA7rHEieTqe4GcU2dzc4LRZLZYrVdNtfrsBXaGbqhgbY7XYHvb9mms47nuIB0FwioKOIQawWgcBygqSoqsAZrqiOmraiurj2qQEAjOwADk+BCiKYoAPQ5tKDJwIRXpgGqYBUhhbrMkMC7sHc7DAK4kxyrBQYgNuu76DwugiNYvzFACiC5AArCC8x4IxzG0qxUBQuYQJNAibSIEIaKYN0ei9LUOKBHo+KEsSloQJ+fAAJpDLQggAAqkAqxYmCQ8YQB2jAwPEYDrCMiRkBkFDsBgbkeSMXk+X5pABUFIVhaQ1yCIKwqihKN6IYqyocEodkQI5ur6ngACyvimp+bYpKQUBmJW8ARj6foBsGtBBpFQYYOGcrRmgsaCKelbnumMCZte1H5jAhbyg+FpPk6L51oo75Ni2P7tp2V49h5QGDsOo5IOOk4tNOVC0AmNr2psjgbpwJhKJuh7Wvayo1owAX9o2Zixg8BLrK1QlgVgU7iBgt0/naD1Lc9r2Vh2sNfQ4v00CuAMBkDcgg3AoH7joR4IFQY0pvgwGXt2VF5nei1PSt1avhtjZ1d+v57d2cCAQOmiMoT4G0JBYS4FQAnwflyEcKhxX2Q57A4XaeEEcRpE5ZRN60fRculU5uTWOwBt8WAAlCSJOQyAAHEU/ylD8xxgnoutlXUWmICIOktIizgiIZGImVi/i4nozCsHzYkCMIYhUJbKIKVJdvqNQFR4DkRhuxYntws0rRIrkuSuCJzCwEE4fAYYnHR/R1SRKQaybOxi7AHK7BoUxGrqU3nH3C3Fpt7Z8usp8fCRZYJtt7xcq8eIYyaEgoCDIocAbng8EgK4rhAA=="}
declare const player: import('hikkaku').Target
import { whenFlagClicked, gotoXY } from 'hikkaku/blocks'
// ---cut---
const startX = 24

player.run(() => {
  whenFlagClicked(() => {
    gotoXY(startX, 0)
  })
})
```

Unsafe: runtime handlers calling JavaScript APIs.

```ts twoslash
// @twoslash-cache: {"v":1,"hash":"d369c364550ffa91c7cc114f7137b3cd46884c75d13d4294f6d0f1701091adac","data":"N4Igdg9gJgpgziAXAbVAFwJ4AcZJACwgDcYAnEAGhDRgA808BjCMONAAiwBsBDDMxOwAqPUgHMYaADwAjCBC4weYAHyUQbUQ0QAGKorBi0+JADYqaURO0hufMuq4BLMLl1VG+UT0Y1yugF8KdGw3AmIHCzobAAoAW0lCKABKYStJWXlFZRUAOlIAVzAYrzAoRVJBGMtxSUERWuk5BSVVVIBeFXYiCCcUwR6+9U1SbQB2fRhDYyQAZgt0m0KwRxc3PRBPb18HRDGgkJw8QhJyKPo8GJ5nHjhUgHd8KYAxXjEAYWdGAGsYKBjND8APxVDpdQb9dgACSc32+PG+BQAQlwID8ADpgJxxLAQUbsR4vN6fJw/P7qKBohCIEAAJSKcAJTzA7DEpBgU3YADM3uwnIzGF9flBcpjMQBJMBYApoQQAA0B3zlorAAHkZdLZewAMqMUg8NCediaGgJMAcGSon7sWBclxONBOFjsYwGvmMnhYHBlP4uiAup7sRgFUjs83GvVOLAcRW5dSWMTU5DIWzeOLDSzWmJg7q9KDsVXRp1ga5xgC6FBT7LQIdY6l1+sN+GNllNUwtVu+Npgdqxjudro4/PYnu9sHzaH9xhgQZDYZjkejLZ833LlZAdB4OMU6jle7QcEx2Nx+OATKJPA+Qt9AW5pAgcXYAHJ8LD4YiAPSWtHfOBPsVgISYCvJeJJkv82bsJ07DAAEySYnucogGWFYaDU2gAEwAIyTNMJiIFhACsCyNHgQEgVepLCqsrhIDhmxePqOz+BhBzUKExwRGc1DRHgRCiEGLBwC0gjvEJLQZloSAACwAJy4UY+ETNQixMOJO76GsSAYR4jE+H4MlsZgRw0ickQ8RcNLxIk0CpGJrAtLkqJiDEuRuVABo8IIygYMgZbJAMebsDEADUWHsFxqI8CkFJUngQiBgAVIlcrMA5ihORALnJHKyXLo6jDsAkxjQBFGoyh6RXwHAl4zpOAYzmlwkZQByAALIACIAHLsLSPZkFMjAwGWJRoGgWBwIgH4frAJCojgpC5HEEAAF5OFwvC5HiYgzVSH4AOowDIH4AIIAArih+TUtB+zkAPomqSySSaMSCEcpBiKXMJHWHgzk0W4OkMdsBkEaxwTsSZ4SnPGvE0lyRS+MW3KSJ4MQuJqghsKQLhiOwAA+7AAKq0gAMgTvUwAAjgU8BoBQfJ9iClM03TkoOgF7BnfecT8jAUh9XAuKsDAXShRhEWnFFUB3JiJYJELPgzlyqMmFQlKMNSIDtd1lMq2GQ0jfgY0TVNM0wHNEALUtq3rZt227ZrB1HadF0HS4lL3B+KtNs9VAjNoWE6EDn0zIgxEqaR8OqwD33A0xoPSQEqHMLAeB2Pwi3LDEkHQcAmLsOewHEteEE5vnLKF4J6UwJlLlPglw7DpAHANgaRrLI6CTsM5pJPvBleFz7aMvibk3TZu2618wcT9wX7BwZicHqMVPBIKA0RTHAxZ4AeIABAEQA=="}
declare const player: import('hikkaku').Target
import { whenFlagClicked, gotoXY } from 'hikkaku/blocks'
// ---cut---
player.run(() => {
  whenFlagClicked(() => {
    console.log('This is not Scratch runtime logic')
    fetch('https://example.com')
  })
})
```
